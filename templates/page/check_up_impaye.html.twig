{% extends "base.html.twig" %}
{% block title %}
	Afficher entreprise / contact
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/dashboard.css')}}">
{% endblock %}
{% block body %}
	<section
		id="contents" class="content_tropical container-fluid">
		<!-- entete content -->
		{% include "nav2.html.twig" %}
		<div id="hrs_content" class="hrs_content">
			<div class="slick_direction_slide">
				<div class="dir_prev">
					<button class="btn btn-default" id="slick_left">
						<span class="fa fa-long-arrow-left"></span>
					</button>
				</div>
				<div class="dir_next">
					<button class="btn btn-default" id="slick_right">
						<span class="fa fa-long-arrow-right"></span>
					</button>
				</div>
			</div>
			<div class="your-class">
				{% for item in resultat %}
					{# 
						item["liste_client_en_attente"]
						item["liste_trans_enc"]
						item["liste_trans_ter"]
					
					#}
					{# calcul grand total #}
					{# attente #}
					{% set attente_tr = 0 %}
					{% set attente_r = 0 %}
					{% set attente_mt = 0 %}
					{% for attente in item["liste_client_en_attente"] %}
						{% set attente_tr = attente_tr + attente.getTotalReglement() %}
						{% set attente_r = attente_r + attente.getReste() %}
						{% set attente_mt = attente_mt + attente.getMontantTotal() %}
					{% endfor %}
					{# en cours #}
					{% set enc_tr = 0 %}
					{% set enc_r = 0 %}
					{% set enc_mt = 0 %}
					{% for enc in item["liste_trans_enc"] %}
						{% set enc_tr = enc_tr + enc.getTotalReglement() %}
						{% set enc_r = enc_r + enc.getReste() %}
						{% set enc_mt = enc_mt + enc.getMontantTotal() %}
					{% endfor %}
					{# en ter #}
					{% set ter_tr = 0 %}
					{% set ter_r = 0 %}
					{% set ter_mt = 0 %}
					{% for ter in item["liste_trans_ter"] %}
						{% set ter_tr = ter_tr + ter.getTotalReglement() %}
						{% set ter_r = ter_r + ter.getReste() %}
						{% set ter_mt = ter_mt + ter.getMontantTotal() %}
					{% endfor %}

					{% set g_total_reg = attente_tr + enc_tr + ter_tr %}
					{% set g_total_reste = attente_r + enc_r + ter_r %}
					{% set g_total_mt = attente_mt + enc_mt + ter_mt %}

					<div class="item_slide">
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<section class="section_part" id="section_part_top">
								<div class="sous_titre sous_titre_tw sous_titre_show_client">
									<h3>{{ item['entreprise'] }}</h3>
								</div>
								<div class="liste_chiffre_daf">
									<div class="unite_chiffre chiffre_daf">
										<div class="titre_ca">
											<h4>Chiffre d'affaires</h4>
										</div>
										<div class="montant_value" id = "div_montant_ca">
											{# chiffre d'aff item #}
											<span class="montant">
												{{ g_total_mt }}
											</span>
											<span>Ar</span>
										</div>
									</div>
									<div class="unite_chiffre chiffre_daf_enc">
										<div class="titre_ca">
											<h4>Chiffre d'affaires encaissé</h4>
										</div>
										<div
											class="montant_value" id="div_montant_enc">
											{# ca enc #}
											<span class="montant">
												{{ g_total_reg }}
											</span>
											<span>Ar</span>
										</div>
									</div>
									<div class="unite_chiffre chiffre_daf_a_enc">
										<div class="titre_ca">
											<h4>Chiffre d'affaires à encaissé</h4>
										</div>
										<div
											class="montant_value" id="div_montant_a_enc"> 
											{# ca a enc #}
											<span class="montant">{{g_total_reste}}</span>
											<span>Ar</span>
										</div>
									</div>
								</div>
							</section>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<h3 class="small_tittle">Contact</h3>
							<div class="add_contact">
								<a href="#" class="btn btn-default" data-index = "{{ item['index'] }}" data-target="#modal_add_contact" data-client="{{ item['entreprise'] }}">
									<span class="fa fa-plus"></span>
								</a>
							</div>
							<div class="tab_small_content">
								<table class="table small_tab">
									<thead>
										<tr>
											<th>
												<span>Contact</span>
											</th>
											<th>
												<span>Email</span>
											</th>
											<th>
												<span>N° de tél</span>
											</th>
											<th>
												<span>Actions</span>
											</th>
										</tr>
									</thead>
									<tbody class="liste_tab_contact" id="{{ 'liste_tab_contact' ~ item['index'] }}"  data-client="{{ item['entreprise'] }}" data-index = "{{ item['index'] }}">
										<tr>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										{% for contact in item['liste_contact'] %}
											<tr>
												<td>
													<span>{{ contact['nom_en_contact'] }}</span>
												</td>
												<td>
													<span>{{ contact['email'] }}</span>
												</td>
												<td>
													<span>{{ contact['telephone'] }}</span>
												</td>
												<td>
													<div class="list_action">
														<a href="#" class="edit_contact" data-id="{{ contact['id'] }}"
															 data-client="{{ item['entreprise'] }}" data-index = "{{ item['index'] }}">
															<span class="fa fa-edit"></span>
														</a>
														<a href="#" class="delete_contact" data-id="{{ contact['id'] }}"
															 data-client="{{ item['entreprise'] }}" data-index = "{{ item['index'] }}">
															<span class="fa fa-trash-o"></span>
														</a>
													</div>
												</td>
											</tr>

										{% endfor %}
									</tbody>
								</table>

							</div>
						</div>

						{# debut tab #}
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="tw_sous_titre">
								<h3>Facture en attente de paiement</h3>
							</div>
							<div class="tableau_tropical tableau_scroll">
								<div class="table_content">
									<div class="table_header">
										<div class="t_header_row t_header_trans">
											<div class="tw_client_trans">
												<span>Références</span>
											</div>
											<div class="tw_details_trans">
												<span>Détails</span>
											</div>
											<div class="tw_type_trans_trans">
												<span>Type de transaction</span>
											</div>
											<div class="tw_etat_prod_trans">
												<span>Etat de production</span>
											</div>
											<div
												class="tw_etape_prod_trans">
												{# % production #}
												<span>% production</span>
											</div>
											<div class="tw_paiement_trans">
												<span>Paiement</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="total_reglement" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="total_reglement" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_reste_trans">
												<span>Reste à payé</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="reste" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="reste" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_montant_total_trans">
												<span>Montant total</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="montant_total" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="montant_total" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_date_conf_trans">
												<span>Date de confirmation</span>
											</div>
											<div class="tw_date_facture_trans">
												<span>Date de facture</span>
											</div>
										</div>
									</div>
									<div class="table_body liste_pf">
										<div class="dr_tab_trans">
											<div {% if item["liste_client_en_attente"]|length > 11 %} class="block_all_tr block_tr_scroll" {% else %} class="block_all_tr block_tr_scroll block_tr_scroll_other" {% endif %}>
													{% set total_total_reglement_enc = 0 %}
													{% set total_reste_enc = 0 %}
													{% set total_montant_total_enc = 0 %}

												{% for item_client in item["liste_client_en_attente"] %}

													{% set total_total_reglement_enc = total_total_reglement_enc + item_client.getTotalReglement() %}
													{% set 	total_reste_enc = total_reste_enc + item_client.getReste() %}
													{% set	total_montant_total_enc= total_montant_total_enc + item_client.getMontantTotal() %}

													<div class="t_body_row sous_tab_body">
														<div class="tw_client_trans">
															<span>{{ item_client.getIdPro() }}</span>
														</div>
														<div class="tw_details_trans">
															<span>{{ item_client.getDetail() }}</span>
														</div>
														<div class="tw_type_trans_trans">
															<span class="value">{{ item_client.getTypeTransaction() }}</span>
														</div>
														<div class="tw_etat_prod_trans">
															<span class="value">{{ item_client.getEtatProduction() }}</span>
														</div>
														<div class="tw_etape_prod_trans">
															<span class="value">{{ item_client.getEtapeProduction() }}%</span>
														</div>
														<div class="tw_paiement_trans">
															<span class="montant value">{{ item_client.getTotalReglement() }}</span>
														</div>
														<div class="tw_reste_trans">
															<span class="montant">
																{{ item_client.getReste() }}
															</span>
														</div>
														<div class="tw_montant_total_trans">
															<span class="montant">{{ item_client.getMontantTotal() }}</span>
														</div>
														<div class="tw_date_conf_trans">
															<span>
																{{ item_client.getDateConfirmation() | date('d-m-Y') }}
															</span>
														</div>
														<div class="tw_date_conf_trans">
															<span>
																{{ item_client.getDateFacture() | date('d-m-Y') }}
															</span>
														</div>
													</div>
												{% endfor %}
											</div>
										</div>
										<div class="t_footer_row sous_tab_body total_content t_footer_trans">
											<div class="tw_client_trans">
												<span>Total</span>
											</div>
											<div class="tw_details_trans">
												<span></span>
											</div>
											<div class="tw_type_trans_trans">
												<span></span>
											</div>
											<div class="tw_etat_prod_trans">
												<span></span>
											</div>
											<div class="tw_etape_prod_trans">
												<span></span>
											</div>
											<div class="tw_paiement_trans">
												<span class="montant value" id="total_paiement_enc">
													{{ total_total_reglement_enc }}
												</span>
											</div>
											<div class="tw_reste_trans">
												<span class="montant value" id="total_reste_enc">
													{{ total_reste_enc }}
												</span>
											</div>
											<div class="tw_montant_total_trans">
												<span class="montant value" id="total_montant_enc">
													{{ total_montant_total_enc }}
												</span>
											</div>
											<div class="tw_date_conf_trans">
												<span></span>
											</div>
											<div class="tw_date_facture_trans">
												<span></span>
											</div>
										</div>

									</div>
								</div>
							</div>
						</div>
						{# fin tab #}
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="titre_remarque">
								<h4>Remarque</h4>
							</div>
							<div class="form_remarque1">
								<form action="" class="form-inline form_remarque">
									<div class="form-group div_date_remarque">
										{# par defaut date du jour #}
										<label for="">Date:
										</label>
										<input type="date" class="form-control date_remarque" value="{{ today }}">
									</div>
									<div class="form-group div_id_pro_facture">
										<label for="">Concerne:
										</label>
										<select name="" class="form-control id_pro_facture" data-client="{{ item['entreprise'] }}">
											{% for item_client in item['liste_client_en_attente'] %}
												<option value="{{ item_client.getIdPro() }}">{{ item_client.getIdPro() }}</option>
											{% endfor %} 
										</select>
									</div>
									<div class="form-group div_observation">
										<label for="">Observation:
										</label>
										<input type="text" class="form-control observation observation">
									</div>
									<div class="form-group">
										<input type="submit" class="valider_remarque_facture btn btn-xs btn-default" value="Valider" data-index = "{{ item['index'] }}"  data-client="{{ item['entreprise'] }}">
									</div>
								</form>
								<div class="liste_pf_selected_facture" id="{{ "liste_pf_selected_facture" ~ item['index'] }}" data-client="{{ item['entreprise'] }}" data-index="{{ item['index'] }}"></div>
							</div>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="tab_small_content">
								<table class="table small_tab">
									<thead>
										<tr class="trh_remarque_a_ter">
											<th class="t_date_rem">
												<span>Date</span>
											</th>
											<th class="t_concerne_rem">
												<span>Concerne</span>
											</th>
											<th class="thh_remarque_a_ter t_obs_rem">
												<span>Observation</span>
											</th>
											<th class="t_action_rem">
												<span>Terminer</span>
											</th>
										</tr>
									</thead>
									<tbody class="tbody__liste_rem_non" data-client="{{ item['entreprise'] }}">
										<tr>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										{% for remarque in item['liste_remarque_facture']  %}
											<tr class="trb_remarque_a_ter">
												<td class="t_date_rem">
													<span>{{ remarque['date_remarque'] | date("d-m-Y") }}</span>
												</td>
												<td class="t_concerne_rem">
													<span>{{ remarque['concerne'] }}</span>
												</td>
												<td class="tbd_remarque_a_ter t_obs_rem">
													<p class="observation">
														{{ remarque['observation'] }}
													</p>
												</td>
												<td class="t_action_rem">
													<div class="liste_action">
														<a href="#" data-id="{{ remarque['id'] }}" class="edit_remarque" data-index = "{{ item['index'] }}">
															<span class=" fa fa-check"></span>
														</a>
													</div>
												</td>
											</tr>

										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>
						{# liste des client en cours #}
						
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="tw_sous_titre">
								<h3>Transaction en cours</h3>
							</div>
							<div class="tableau_tropical tableau_scroll">
								<div class="table_content">
									<div class="table_header">
										<div class="t_header_row t_header_trans">
											<div class="tw_client_trans">
												<span>Références</span>
											</div>
											<div class="tw_details_trans">
												<span>Détails</span>
											</div>
											<div class="tw_type_trans_trans">
												<span>Type de transaction</span>
											</div>
											<div class="tw_etat_prod_trans">
												<span>Etat de production</span>
											</div>
											<div
												class="tw_etape_prod_trans">
												{# % production #}
												<span>% production</span>
											</div>
											<div class="tw_paiement_trans">
												<span>Paiement</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="total_reglement" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="total_reglement" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_reste_trans">
												<span>Reste à payé</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="reste" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="reste" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_montant_total_trans">
												<span>Montant total</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="montant_total" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="montant_total" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_date_conf_trans">
												<span>Date de confirmation</span>
											</div>
											<div class="tw_date_facture_trans">
												<span>Date de facture</span>
											</div>
										</div>
									</div>
									<div class="table_body liste_pf">
										<div class="dr_tab_trans">
											<div {% if item["liste_trans_enc"]|length > 11 %} class="block_all_tr block_tr_scroll" {% else %} class="block_all_tr block_tr_scroll block_tr_scroll_other" {% endif %}>
													{% set total_total_reglement_enc = 0 %}
													{% set total_reste_enc = 0 %}
													{% set total_montant_total_enc = 0 %}

												{% for item_client in item["liste_trans_enc"] %}

													{% set total_total_reglement_enc = total_total_reglement_enc + item_client.getTotalReglement() %}
													{% set 	total_reste_enc = total_reste_enc + item_client.getReste() %}
													{% set	total_montant_total_enc= total_montant_total_enc + item_client.getMontantTotal() %}

													<div class="t_body_row sous_tab_body">
														<div class="tw_client_trans">
															<span>{{ item_client.getIdPro() }}</span>
														</div>
														<div class="tw_details_trans">
															<span>{{ item_client.getDetail() }}</span>
														</div>
														<div class="tw_type_trans_trans">
															<span class="value">{{ item_client.getTypeTransaction() }}</span>
														</div>
														<div class="tw_etat_prod_trans">
															<span class="value">{{ item_client.getEtatProduction() }}</span>
														</div>
														<div class="tw_etape_prod_trans">
															<span class="value">{{ item_client.getEtapeProduction() }}%</span>
														</div>
														<div class="tw_paiement_trans">
															<span class="montant value">{{ item_client.getTotalReglement() }}</span>
														</div>
														<div class="tw_reste_trans">
															<span class="montant">
																{{ item_client.getReste() }}
															</span>
														</div>
														<div class="tw_montant_total_trans">
															<span class="montant">{{ item_client.getMontantTotal() }}</span>
														</div>
														<div class="tw_date_conf_trans">
															<span>
																{{ item_client.getDateConfirmation() | date('d-m-Y') }}
															</span>
														</div>
														<div class="tw_date_conf_trans">
															<span>
																{{ item_client.getDateFacture() | date('d-m-Y') }}
															</span>
														</div>
													</div>
												{% endfor %}
											</div>
										</div>
										<div class="t_footer_row sous_tab_body total_content t_footer_trans">
											<div class="tw_client_trans">
												<span>Total</span>
											</div>
											<div class="tw_details_trans">
												<span></span>
											</div>
											<div class="tw_type_trans_trans">
												<span></span>
											</div>
											<div class="tw_etat_prod_trans">
												<span></span>
											</div>
											<div class="tw_etape_prod_trans">
												<span></span>
											</div>
											<div class="tw_paiement_trans">
												<span class="montant value" id="total_paiement_enc">
													{{ total_total_reglement_enc }}
												</span>
											</div>
											<div class="tw_reste_trans">
												<span class="montant value" id="total_reste_enc">
													{{ total_reste_enc }}
												</span>
											</div>
											<div class="tw_montant_total_trans">
												<span class="montant value" id="total_montant_enc">
													{{ total_montant_total_enc }}
												</span>
											</div>
											<div class="tw_date_conf_trans">
												<span></span>
											</div>
											<div class="tw_date_facture_trans">
												<span></span>
											</div>
										</div>

									</div>
								</div>
							</div>
						</div>
						{# fin tab #}
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="titre_remarque">
								<h4>Remarque</h4>
							</div>
							<div class="form_remarque1">
								<form action="" class="form-inline form_remarque">
									<div class="form-group div_date_remarque">
										{# par defaut date du jour #}
										<label for="">Date:
										</label>
										<input type="date" class="form-control date_remarque" value="{{ today }}">
									</div>
									<div class="form-group div_id_pro_en_cours">
										<label for="">Concerne:
										</label>
										<select name="" class="form-control id_pro_en_cours" data-client="{{ item['entreprise'] }}">
											{% for item_client in item['liste_trans_enc'] %}
												<option value="{{ item_client.getIdPro() }}">{{ item_client.getIdPro() }}</option>
											{% endfor %} 
										</select>
									</div>
									<div class="form-group div_observation">
										<label for="">Observation:
										</label>
										<input type="text" class="form-control observation observation">
									</div>
									<div class="form-group">
										<input type="submit" class="valider_remarque_en_cours btn btn-xs btn-default" value="Valider" data-index = "{{ item['index'] }}"  data-client="{{ item['entreprise'] }}">
									</div>
								</form>
								<div class="liste_pf_selected_en_cours" id="{{ "liste_pf_selected_en_cours" ~ item['index'] }}" data-client="{{ item['entreprise'] }}" data-index="{{ item['index'] }}"></div>
							</div>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="tab_small_content">
								<table class="table small_tab">
									<thead>
										<tr class="trh_remarque_a_ter">
											<th class="t_date_rem">
												<span>Date</span>
											</th>
											<th class="t_concerne_rem">
												<span>Concerne</span>
											</th>
											<th class="thh_remarque_a_ter t_obs_rem">
												<span>Observation</span>
											</th>
											<th class="t_action_rem">
												<span>Terminer</span>
											</th>
										</tr>
									</thead>
									<tbody class="tbody__liste_rem_non" data-client="{{ item['entreprise'] }}">
										<tr>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										{% for remarque in item['liste_remarque_enc']  %}
											<tr class="trb_remarque_a_ter">
												<td class="t_date_rem">
													<span>{{ remarque['date_remarque'] | date("d-m-Y") }}</span>
												</td>
												<td class="t_concerne_rem">
													<span>{{ remarque['concerne'] }}</span>
												</td>
												<td class="tbd_remarque_a_ter t_obs_rem">
													<p class="observation">
														{{ remarque['observation'] }}
													</p>
												</td>
												<td class="t_action_rem">
													<div class="liste_action">
														<a href="#" data-id="{{ remarque['id'] }}" class="edit_remarque" data-index = "{{ item['index'] }}">
															<span class=" fa fa-check"></span>
														</a>
													</div>
												</td>
											</tr>

										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>

						{# fin client en cours #}

						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="tw_sous_titre">
								<h3>Transaction terminée</h3>
							</div>
							<div class="tableau_tropical tableau_scroll">
								<div class="table_content">
									<div class="table_header">
										<div class="t_header_row t_header_trans">
											<div class="tw_client_trans">
												<span>Références</span>
											</div>
											<div class="tw_details_trans">
												<span>Détails</span>
											</div>
											<div class="tw_type_trans_trans">
												<span>Type de transaction</span>
											</div>
											<div class="tw_etat_prod_trans">
												<span>Etat de production</span>
											</div>
											<div
												class="tw_etape_prod_trans">
												{# % production #}
												<span>% production</span>
											</div>
											<div class="tw_paiement_trans">
												<span>Paiement</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="total_reglement" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="total_reglement" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_reste_trans">
												<span>Reste à payé</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="reste" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="reste" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_montant_total_trans">
												<span>Montant total</span>
												<span class="span_tri">
													<a href="#" class="a_tri" data-type="montant_total" data-data="ASC">
														<small class="fa fa-sort-asc"></small>
													</a>
													<a href="#" class="a_tri" data-type="montant_total" data-data="DESC">
														<small class="fa fa-sort-desc"></small>
													</a>
												</span>
											</div>
											<div class="tw_date_conf_trans">
												<span>Date de confirmation</span>
											</div>
											<div class="tw_date_facture_trans">
												<span>Date de facture</span>
											</div>
										</div>
									</div>
									<div class="table_body" id="div__table_trans_terminer">
										<div class="dr_tab_trans">
											<div {% if item["liste_trans_ter"]|length > 11 %} class="block_all_tr block_tr_scroll" {% else %} class="block_all_tr block_tr_scroll block_tr_scroll_other" {% endif %}>
													{% set total_total_reglement_ter = 0 %}
													{% set total_reste_ter = 0 %}
													{% set total_montant_total_ter = 0 %}
													{% for item_trans_ter in item["liste_trans_ter"] %}
													{% set
														total_total_reglement_ter = total_total_reglement_ter + item_trans_ter.getTotalReglement() %}
													{% set 	total_reste_ter = total_reste_ter + item_trans_ter.getReste() %}
													{% set	total_montant_total_ter= total_montant_total_ter + item_trans_ter.getMontantTotal() %}
													
													
													<div class="t_body_row sous_tab_body">
														<div class="tw_client_trans">
															<span>{{ item_trans_ter.getIdPro() }}</span>
														</div>
														<div class="tw_details_trans">
															<span>{{ item_trans_ter.getDetail() }}</span>
														</div>
														<div class="tw_type_trans_trans">
															<span class="value">{{ item_trans_ter.getTypeTransaction() }}</span>
														</div>
														<div class="tw_etat_prod_trans">
															<span class="value">{{ item_trans_ter.getEtatProduction() }}</span>
														</div>
														<div class="tw_etape_prod_trans">
															<span class="value">{{ item_trans_ter.getEtapeProduction() }}%</span>
														</div>
														<div class="tw_paiement_trans">
															<span class="montant value">{{ item_trans_ter.getTotalReglement() }}</span>
														</div>
														<div class="tw_reste_trans">
															<span class="montant">
																{{ item_trans_ter.getReste() }}
															</span>
														</div>
														<div class="tw_montant_total_trans">
															<span class="montant">{{ item_trans_ter.getMontantTotal() }}</span>
														</div>
														<div class="tw_date_conf_trans">
															<span>
																{{ item_trans_ter.getDateConfirmation() | date('d-m-Y') }}
															</span>
														</div>
														<div class="tw_date_conf_trans">
															<span>
																{{ item_trans_ter.getDateFacture() | date('d-m-Y') }}
															</span>
														</div>
													</div>
												{% endfor %}
											</div>
										</div>
										<div class="t_footer_row sous_tab_body total_content t_footer_trans">
											<div class="tw_client_trans">
												<span>Total</span>
											</div>
											<div class="tw_details_trans">
												<span></span>
											</div>
											<div class="tw_type_trans_trans">
												<span></span>
											</div>
											<div class="tw_etat_prod_trans">
												<span></span>
											</div>
											<div class="tw_etape_prod_trans">
												<span></span>
											</div>
											<div class="tw_paiement_trans">
												<span class="montant value" id="total_paiement_ter">
													{{ total_total_reglement_ter }}
												</span>
											</div>
											<div class="tw_reste_trans">
												<span class="montant value" id="total_reste_ter">
													{{ total_reste_ter }}
												</span>
											</div>
											<div class="tw_montant_total_trans">
												<span class="montant value" id="total_montant_ter">
													{{ total_montant_total_ter }}
												</span>
											</div>
											<div class="tw_date_conf_trans">
												<span></span>
											</div>
											<div class="tw_date_facture_trans">
												<span></span>
											</div>
										</div>

									</div>
								</div>
							</div>
						</div>
						{# fin trans en cours #}
						<div class="col-lg-12 col-md-12 col-sm-12 col-sm-12 col-xs-12">
							<div class="titre_remarque">
								<h4>Remarque</h4>
							</div>
							<div class="tab_small_content" style="margin-top:25px;">
								<table class="table small_tab">
									<thead>
										<tr class="trh_remarque_a_ter">
											<th class="t_date_rem">
												<span>Date</span>
											</th>
											<th class="t_concerne_rem">
												<span>Concerne</span>
											</th>
											<th class="thh_remarque_a_ter t_obs_rem">
												<span>Observation</span>
											</th>
											<th class="t_action_rem">
												<span>Supprimer</span>
											</th>
										</tr>
									</thead>
									<tbody class="tbody__liste_rem_non" data-client="{{ item['entreprise'] }}">
										<tr>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										{% for remarque_ter in item['liste_remarque_ter']  %}
											<tr class="trb_remarque_a_ter">
												<td class="t_date_rem">
													<span>{{ remarque_ter['date_remarque'] | date("d-m-Y") }}</span>
												</td>
												<td class="t_concerne_rem">
													<span>{{ remarque_ter['concerne'] }}</span>
												</td>
												<td class="tbd_remarque_a_ter t_obs_rem">
													<p class="observation">
														{{ remarque_ter['observation'] }}
													</p>
												</td>
												<td class="t_action_rem">
													<div class="liste_action">
														<a href="#" data-id="{{ remarque_ter['id'] }}" class="delete_remarque" data-index="{{ item['index'] }}">
															<span class=" fa fa-trash-o"></span>
														</a>
													</div>
												</td>
											</tr>

										{% endfor %}
									</tbody>

								</table>
							</div>
						</div>

					</div>
				{% endfor %}
			</div>

		</div>
	</section>

	{# modal nouveau contact #}
	<div class="modal fade" id="modal_add_contact" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Ajouter un nouveau contact</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="modal_form_add_contact">
					<h4 class="text-center h4_text_client_modal" ></h4>
					<form action="">
						<div class="form-group">
							<label for="">Contact</label>
							<input type="text" placeholder="Contact" id="contact" class="form-control">
						</div>
						<div class="form-group">
							<label for="">Email</label>
							<input type="text" id="email" placeholder="Adresse@mail...." class="form-control">
						</div>
						<div class="form-group">
							<label for="">N° Téléphone</label>
							<input type="text" id="telephone" placeholder="03x xxx" class="form-control">
						</div>
						<div class="form-group">
							<button class="btn btn-default" type="submit" id="button_add_contact" data-id="" data-index="">
								<span>Enregistrer</span>
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	{# fin modal contact #}

{% endblock %}
{% block javascripts %}
	<script>
		$(document).ready(function () {
			$('.your-class').slick({
				infinite: true,
				slidesToShow: 1,
				slidesToScroll: 1,
				nextArrow: '.dir_next button',
				prevArrow: '.dir_prev button'
			});

			var index = {{ index }}

			function deplace_slide_index(params) {
				$('.your-class' ).slick('slickGoTo', parseInt(params));
			}
			
			deplace_slide_index(index);

			$(".add_contact a").on("click", function(env){
				env.preventDefault();
				var index = $(this).attr('data-index');
				$('#button_add_contact').attr('data-index', parseInt(index));
				$("#modal_add_contact").modal("hide");
				var client = $(this).attr("data-client");
				$(".h4_text_client_modal").text(client);
				$("#modal_add_contact").modal("show");
			})

			// add_contact
			$(document).on("click", "#button_add_contact", function(ev){
				ev.preventDefault();
				var index = $(this).attr('data-index');
				var contact = $("#contact").val();
				// var type_contact = $("#type_contact").val();
				var email = $("#email").val(); 
				var telephone = $("#telephone").val();
				var id_contact = $(this).attr("data-id");
				var client = $(".h4_text_client_modal").text();
				var data = {
					"nom_en_contact"        : contact,               
					"email"                 : email,
					"telephone"             : telephone,
					"client"            : client,
					"id_contact"            : id_contact,
				}

				$.ajax({
					url         :  "/tropical_wood/add_contact",
					type        : "POST",
					data        : data,
					success     : function(response){
						$("#modal_add_contact").modal('hide');
						window.location.href = "/admin/check_up_impaye/" + index;
					},
					error       : function(){
						alert("erreur add contact");
					}
				})
			})

			// remarque

			var liste_pf_facture = [];
			var liste_pf_en_cours = [];

                $(".id_pro_facture").on('change', function(){
					// on enregistre le select du client concerné
					var client = $(this).attr("data-client");
					var client_liste = $(".liste_pf_selected_facture_change").attr("data-client");
					if(client != client_liste){
						liste_pf_facture = [];
					}
					$(".liste_pf_selected_facture").removeClass("liste_pf_selected_facture_change");
					if(!$(this).parent().parent().siblings(".liste_pf_selected_facture").hasClass("liste_pf_selected_facture_change")){
						$(this).parent().parent().siblings(".liste_pf_selected_facture").addClass("liste_pf_selected_facture_change");
					}
					$(".id_pro_facture").removeClass("change");
					$(this).addClass("change");
                    var choice = $(this).val();
					var client = $(this).attr("data-client");
                    var test = false;
                    for(var i=0; i< liste_pf_facture.length; i++){
                        if(choice == liste_pf_facture[i]){
                            test = true;
                        }
                    }
                    
                    if(test == false){
                        liste_pf_facture.push(choice);
                    }
                    lister_choice_pf_facture()
                })

				// event change id_pro pour en cours
				$(".id_pro_en_cours").on('change', function(){
					// on enregistre le select du client concerné
					var client = $(this).attr("data-client");
					var client_liste = $(".liste_pf_selected_en_cours_change").attr("data-client");
					if(client != client_liste){
						liste_pf_facture = [];
					}
					$(".liste_pf_selected_en_cours").removeClass("liste_pf_selected_en_cours_change");
					if(!$(this).parent().parent().siblings(".liste_pf_selected_en_cours").hasClass("liste_pf_selected_en_cours_change")){
						$(this).parent().parent().siblings(".liste_pf_selected_en_cours").addClass("liste_pf_selected_en_cours_change");
					}
					$(".id_pro_en_cours").removeClass("change");
					$(this).addClass("change");
                    var choice = $(this).val();
					var client = $(this).attr("data-client");
                    var test = false;
                    for(var i=0; i< liste_pf_en_cours.length; i++){
                        if(choice == liste_pf_en_cours[i]){
                            test = true;
                        }
                    }
                    
                    if(test == false){
                        liste_pf_en_cours.push(choice);
                    }
                    lister_choice_pf_en_cours()
                })
				// fin event change pour en cours 
				

                function lister_choice_pf_facture(){
                    var html = "<ul>";
                    for(var i = 0; i<liste_pf_facture.length; i++){
                        html += `
                                <li class="li_unite_selected_pf">
                                    <div>
                                        <p class="p_pf_value">`+ liste_pf_facture[i] +`</p>
                                        <span class="fa fa-times exit_pf_facture" data-pf = "`+ liste_pf_facture[i] +`"></span>
                                    </div>
                                </li>
                        `;
                    }
                    html += "</ul>";
                    $(".liste_pf_selected_facture_change").html(html);

                }

				// lister_choice_pf poue en cours 
				function lister_choice_pf_en_cours(){
                    var html = "<ul>";
                    for(var i = 0; i<liste_pf_en_cours.length; i++){
                        html += `
                                <li class="li_unite_selected_pf">
                                    <div>
                                        <p class="p_pf_value">`+ liste_pf_en_cours[i] +`</p>
                                        <span class="fa fa-times exit_pf_en_cours" data-pf = "`+ liste_pf_en_cours[i] +`"></span>
                                    </div>
                                </li>
                        `;
                    }
                    html += "</ul>";
                    $(".liste_pf_selected_en_cours_change").html(html);

                }
				// fin lister_choice_pf poue en cours 

                $(document).on("click", ".exit_pf_facture", function(){
                    var text = $(this).attr("data-pf");
                    const index = liste_pf_facture.indexOf(text);
				    if (index > -1) {
					    liste_pf_facture.splice(index, 1);
                    }
                    // console.log(liste_pf);
                    lister_choice_pf_facture();
                })

				// event click .exit_pf_en cours
				
				$(document).on("click", ".exit_pf_en_cours", function(){
                    var text = $(this).attr("data-pf");
                    const index = liste_pf_en_cours.indexOf(text);
				    if (index > -1) {
					    liste_pf_en_cours.splice(index, 1);
                    }
                    // console.log(liste_pf);
                    lister_choice_pf_en_cours();
                })

				// fin event cilck .exit_pf_en cours


			$(".valider_remarque_facture").on("click", function(ev){
                ev.preventDefault();
				
				var client = $(this).attr("data-client");
				var index = $(this).attr("data-index");
				var date_remarque = $(this).parent().siblings('.div_date_remarque').find('.date_remarque').val();
				var id_pro_facture = $(this).parent().siblings('.div_id_pro_facture').find('.id_pro_facture').val();
				var observation = $(this).parent().siblings('.div_observation').find('.observation').val();
                if(liste_pf_facture.length == 0){
                    var data = {
                        "date_remarque" : date_remarque,
                        "id_pro"        : id_pro_facture,
                        "observation"   : observation,
                        "client"     	: client,
						"contrainte"	: "facturé"
                    }
					console.log(data)
                    add_remarque_pf_facture(data, index);
                }
               
                if(liste_pf_facture.length > 0){
                    var mult_pf = "";
                    for(var i = 0; i< liste_pf_facture.length; i++){
                        if(i < liste_pf_facture.length - 1){
                            mult_pf += liste_pf_facture[i] + ", ";
                        }
                        else{
                            mult_pf += liste_pf_facture[i];
                        }
                        
                    }
                    var data = {
                        "date_remarque" : date_remarque,
                        "id_pro"        : mult_pf,
                        "observation"   : observation,
                        "client"     	: client,
						"contrainte"	: "facturé"
                    }
					console.log(data)
                    add_remarque_pf_facture(data, index);
                }
            })

			// valider rem en cours 
			$(".valider_remarque_en_cours").on("click", function(ev){
                ev.preventDefault();
				
				var client = $(this).attr("data-client");
				var index = $(this).attr("data-index");
				var date_remarque = $(this).parent().siblings('.div_date_remarque').find('.date_remarque').val();
				var id_pro_en_cours = $(this).parent().siblings('.div_id_pro_en_cours').find('.id_pro_en_cours').val();
				var observation = $(this).parent().siblings('.div_observation').find('.observation').val();
                if(liste_pf_en_cours.length == 0){
                    var data = {
                        "date_remarque" : date_remarque,
                        "id_pro"        : id_pro_en_cours,
                        "observation"   : observation,
                        "client"     	: client,
						"contrainte"	: "en cours"
                    }
					console.log(data)
                    add_remarque_pf_en_cours(data, index);
                }
               
                if(liste_pf_en_cours.length > 0){
                    var mult_pf = "";
                    for(var i = 0; i< liste_pf_en_cours.length; i++){
                        if(i < liste_pf_en_cours.length - 1){
                            mult_pf += liste_pf_en_cours[i] + ", ";
                        }
                        else{
                            mult_pf += liste_pf_en_cours[i];
                        }
                        
                    }
                    var data = {
                        "date_remarque" : date_remarque,
                        "id_pro"        : mult_pf,
                        "observation"   : observation,
                        "client"     	: client,
						"contrainte"	: "en cours"
                    }
					console.log(data)
                    add_remarque_pf_en_cours(data, index);
                }
            })
			// fin valider rem en cours

            function add_remarque_pf_facture(data, index){
                 $.ajax({
                    url     : "/tropical_wood/add_remarque", 
                    type    : "POST",
                    data    : data, 
                    success : function(response){
						
                      	window.location.href = "/admin/check_up_impaye/" + index;
                        liste_pf_facture = [];
                        lister_choice_pf_facture();
                    },
                    error   : function(){
                        alert('erreur dans valider remarque');
                    }
                })
            }

			// add_rem en cours 
			function add_remarque_pf_en_cours(data, index){
                 $.ajax({
                    url     : "/tropical_wood/add_remarque", 
                    type    : "POST",
                    data    : data, 
                    success : function(response){
						
                      	window.location.href = "/admin/check_up_impaye/" + index;
                        liste_pf_en_cours = [];
                        lister_choice_pf_en_cours();
                    },
                    error   : function(){
                        alert('erreur dans valider remarque');
                    }
                })
            }
			// fin add_rem en cours

			// edit contact
			// click edit contact 
			$(document).on("click", ".edit_contact", function(ev){
				ev.preventDefault();
				var id_contact = $(this).attr('data-id');
				var client = $(this).attr('data-client');
				var index = $(this).attr('data-index');
				$.ajax({
					url : "/tropical_wood/edit_contact",
					type : "POST",
					data : {
						"nom_client" : client,
						"index"		 : index,
						"id_contact" : id_contact
					},
					success : function(response){
						$("#modal_form_add_contact").html(response);
						$("#modal_add_contact").modal('show');
					}, 
					error : function(){
						alert("erreur au niveau de edit contact");
					}
				})
			})

			// delete contact
			// click delete contact 
			$(document).on("click", ".delete_contact", function(ev){
				ev.preventDefault();
				var id_contact = $(this).attr('data-id');
				var client = $(this).attr('data-client');
				var index = $(this).attr('data-index');
				$bool = confirm("Voulez-vous vraiment supprimer ce contact ?")
				if($bool == true){
					$.ajax({
						url : "/tropical_wood/delete_contact",
						type : "POST",
						data : {
							"nom_client" : client,
							"id_contact" : id_contact
						},
						success : function(response){
							window.location.href = "/admin/check_up_impaye/" + index;
						}, 
						error : function(){
							alert("erreur au niveau de delete contact");
						}
					})
				}
			})

			// dele and ed remarque

			// edit remarque 
            $(document).on('click', ".edit_remarque", function(ev){
                ev.preventDefault();
                var id_remarque = $(this).attr("data-id");
				var index = $(this).attr('data-index');
                var data = {
                    "id_remarque" : id_remarque
                };
                $.ajax({
                    url : "/tropical_wood/edit_remarque",
                    type : "POST",
                    data : data,
                    success : function(response){
                        window.location.href = "/admin/check_up_impaye/" + index;
                    }, 
                    error : function(){
                        alert('erreur edit remarque passer de ter à supp');
                    }
                })
            })

            // delete remarque 
            $(document).on('click', ".delete_remarque", function(ev){
                ev.preventDefault();
                var id_remarque = $(this).attr("data-id");
                var data = {
                    "id_remarque" : id_remarque
                };
                $.ajax({
                    url : "/tropical_wood/delete_remarque",
                    type : "POST",
                    data : data,
                    success : function(response){
                         window.location.href = "/admin/check_up_impaye/" + index;
                    }, 
                    error : function(){
                        alert('erreur edit remarque passer de ter à supp');
                    }
                })
            })

		});
	</script>
{% endblock %}
